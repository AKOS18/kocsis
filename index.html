<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Endless Aut√≥verseny - Ultimate</title>
<style>
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

html, body {
  width: 100%;
  height: 100%;
  background: #111;
  color: #fff;
  font-family: 'Arial', sans-serif;
  overflow: hidden;
}

#game {
  display: block;
  margin: auto;
  background: #000;
}

.overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.9);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 10;
  padding: 20px;
  text-align: center;
  backdrop-filter: blur(5px);
}

#hud {
  position: absolute;
  top: 15px;
  left: 15px;
  font-size: 18px;
  background: rgba(0, 0, 0, 0.7);
  padding: 12px 18px;
  border-radius: 10px;
  z-index: 5;
  border: 2px solid rgba(255, 255, 255, 0.2);
  min-width: 280px;
}

#controls {
  position: absolute;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0, 0, 0, 0.7);
  padding: 15px;
  border-radius: 10px;
  font-size: 14px;
  text-align: center;
  border: 2px solid rgba(255, 255, 255, 0.2);
  width: 90%;
  max-width: 600px;
}

#shopBtn {
  position: absolute;
  right: 20px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 24px;
  padding: 12px 20px;
  background: linear-gradient(to bottom, #2ecc71, #27ae60);
  border: none;
  border-radius: 10px;
  color: white;
  cursor: pointer;
  z-index: 5;
  transition: all 0.3s;
  box-shadow: 0 4px 8px rgba(0,0,0,0.3);
}

#shopBtn:hover {
  background: linear-gradient(to bottom, #27ae60, #219653);
  transform: translateY(-50%) scale(1.05);
}

button {
  padding: 12px 24px;
  margin: 8px;
  font-size: 18px;
  background: linear-gradient(to bottom, #3498db, #2980b9);
  border: none;
  border-radius: 8px;
  color: white;
  cursor: pointer;
  transition: all 0.3s;
  min-width: 200px;
  font-weight: bold;
}

button:hover {
  background: linear-gradient(to bottom, #2980b9, #1c6ea4);
  transform: scale(1.05);
}

button:active {
  transform: scale(0.98);
}

select, input {
  padding: 10px;
  margin: 10px;
  font-size: 16px;
  border-radius: 6px;
  border: 2px solid #3498db;
  background: #222;
  color: white;
  min-width: 200px;
}

h1, h2 {
  margin-bottom: 20px;
  color: #3498db;
  text-shadow: 0 2px 4px rgba(0,0,0,0.5);
}

h1 {
  font-size: 42px;
  margin-bottom: 10px;
  background: linear-gradient(to right, #3498db, #2ecc71);
  -webkit-text-fill-color: transparent;
}

h2 {
  font-size: 32px;
}

p {
  margin: 10px;
  max-width: 600px;
  line-height: 1.5;
}

label {
  margin-top: 15px;
  font-size: 18px;
  display: block;
}

.shop-item {
  background: rgba(30, 30, 40, 0.9);
  padding: 15px;
  margin: 10px;
  border-radius: 10px;
  width: 300px;
  border: 2px solid rgba(52, 152, 219, 0.5);
}

.shop-item h3 {
  color: #f39c12;
  margin-bottom: 8px;
}

.shop-item p {
  margin: 5px 0;
  font-size: 14px;
}

.upgrade-bar {
  width: 100%;
  height: 12px;
  background: #333;
  border-radius: 6px;
  margin: 8px 0;
  overflow: hidden;
}

.upgrade-fill {
  height: 100%;
  background: linear-gradient(to right, #2ecc71, #f1c40f);
  border-radius: 6px;
  transition: width 0.5s;
}

.stats {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 15px;
  margin: 20px;
}

.stat {
  background: rgba(0, 0, 0, 0.6);
  padding: 15px;
  border-radius: 10px;
  min-width: 150px;
  border: 1px solid rgba(255, 255, 255, 0.1);
}

#pauseBtn {
  position: absolute;
  top: 20px;
  right: 20px;
  font-size: 28px;
  padding: 10px 15px;
  background: rgba(0, 0, 0, 0.7);
  border-radius: 8px;
  z-index: 5;
}

#speedometer {
  position: absolute;
  top: 20px;
  right: 100px;
  background: rgba(0, 0, 0, 0.7);
  padding: 10px 15px;
  border-radius: 10px;
  font-size: 18px;
  border: 2px solid #e74c3c;
  min-width: 180px;
}

#gameOver {
  display: none;
}

.powerup-indicator {
  position: absolute;
  top: 100px;
  right: 20px;
  background: rgba(0, 0, 0, 0.8);
  padding: 10px;
  border-radius: 10px;
  font-size: 14px;
  border-left: 4px solid #f1c40f;
}

/* Mobil t√°mogat√°s */
@media (max-width: 768px) {
  #hud {
    font-size: 14px;
    padding: 8px 12px;
    min-width: 200px;
  }
  
  #shopBtn {
    font-size: 20px;
    padding: 10px 15px;
    right: 10px;
  }
  
  #speedometer {
    right: 80px;
    font-size: 14px;
    min-width: 140px;
  }
  
  button {
    min-width: 150px;
    padding: 10px 15px;
    font-size: 16px;
  }
  
  h1 {
    font-size: 32px;
  }
  
  h2 {
    font-size: 24px;
  }
}
</style>
</head>
<body>

<canvas id="game"></canvas>

<div id="hud">
  <div>üí∞ <span id="moneyTxt">0</span> | ‚ö° <span id="speedTxt">0.0</span> | üèÜ Rekord: <span id="recordTxt">0</span></div>
  <div>üöó Szint: <span id="levelTxt">1</span> | üèÅ T√°vols√°g: <span id="distanceTxt">0</span>m | ‚ù§Ô∏è <span id="healthTxt">1/1</span></div>
</div>

<div id="speedometer">
  üöÄ Sebess√©g: <span id="speedValue">0</span> km/h
</div>

<button id="shopBtn" style="display:none">üõí BOLT</button>
<button id="pauseBtn" style="display:none">‚è∏Ô∏è</button>

<div id="controls">
  <strong>Irr√°ny√≠t√°s:</strong> W/‚Üë: El≈ëre | S/‚Üì: H√°tra | A/‚Üê: Balra | D/‚Üí: Jobbra | P: Sz√ºnet
</div>

<!-- MEN√ú -->
<div id="menu" class="overlay">
  <h1>üöó ENDLESS AUT√ìVERSENY üèÅ</h1>
  <p>Menj min√©l messzebb, ker√ºlj az ellenfeleket √©s gy≈±jts p√©nzt a fejleszt√©sekre!</p>
  
  <div class="stats">
    <div class="stat">
      <h3>üèÜ Rekord</h3>
      <p id="menuRecord">0 m</p>
    </div>
    <div class="stat">
      <h3>üí∞ Legt√∂bb p√©nz</h3>
      <p id="menuMoney">0</p>
    </div>
  </div>
  
  <label for="laneSel">S√°vok sz√°ma:</label>
  <select id="laneSel">
    <option value="3">3 (K√∂nny≈±)</option>
    <option value="4" selected>4 (Norm√°l)</option>
    <option value="5">5 (Neh√©z)</option>
    <option value="6">6 (Extr√©m)</option>
  </select>
  
  <label for="carColor">Aut√≥ sz√≠ne:</label>
  <input type="color" id="carColor" value="#ff0000">
  
  <label for="difficulty">Neh√©zs√©g:</label>
  <select id="difficulty">
    <option value="easy">K√∂nny≈±</option>
    <option value="normal" selected>Norm√°l</option>
    <option value="hard">Neh√©z</option>
  </select>
  
  <button onclick="startGame()">J√ÅT√âK IND√çT√ÅSA</button>
  <button onclick="showInstructions()">√öTMUTAT√ì</button>
</div>

<!-- SHOP -->
<div id="shop" class="overlay" style="display:none">
  <h2>üõí FEJLESZT√âSEK</h2>
  <p>üí∞ P√©nz: <span id="shopMoney">0</span></p>
  
  <div class="shop-item">
    <h3>üöÄ Max Sebess√©g</h3>
    <p>Jelenleg: <span id="currentSpeed">6</span> (Max: 15)</p>
    <div class="upgrade-bar">
      <div id="speedBar" class="upgrade-fill" style="width:40%"></div>
    </div>
    <button onclick="buyUpgrade('speed')" id="speedBtn">+1 Sebess√©g - 50$</button>
  </div>
  
  <div class="shop-item">
    <h3>‚ö° Gyorsul√°s</h3>
    <p>Jelenleg: <span id="currentAccel">0.25</span> (Max: 0.5)</p>
    <div class="upgrade-bar">
      <div id="accelBar" class="upgrade-fill" style="width:25%"></div>
    </div>
    <button onclick="buyUpgrade('accel')" id="accelBtn">+0.05 Gyorsul√°s - 40$</button>
  </div>
  
  <div class="shop-item">
    <h3>üß≠ Ir√°ny√≠t√°s</h3>
    <p>Jelenleg: <span id="currentHandling">5</span> (Max: 15)</p>
    <div class="upgrade-bar">
      <div id="handlingBar" class="upgrade-fill" style="width:33%"></div>
    </div>
    <button onclick="buyUpgrade('handling')" id="handlingBtn">+1 Ir√°ny√≠t√°s - 30$</button>
  </div>
  
  <div class="shop-item">
    <h3>üõ°Ô∏è √âlet</h3>
    <p>Jelenleg: <span id="currentHealth">1</span> (Max: 5)</p>
    <div class="upgrade-bar">
      <div id="healthBar" class="upgrade-fill" style="width:20%"></div>
    </div>
    <button onclick="buyUpgrade('health')" id="healthBtn">+1 √âlet - 80$</button>
  </div>
  
  <button onclick="closeShop()">VISSZA A J√ÅT√âKHOZ</button>
</div>

<!-- √öTMUTAT√ì -->
<div id="instructions" class="overlay" style="display:none">
  <h2>üéÆ √öTMUTAT√ì</h2>
  <div style="text-align:left; max-width: 600px;">
    <p><strong>üéØ C√©l:</strong> Menj min√©l messzebb an√©lk√ºl, hogy √ºtk√∂zn√©l m√°s aut√≥kkal!</p>
    <p><strong>üéÆ Ir√°ny√≠t√°s:</strong></p>
    <ul>
      <li>W / FELFEL√â NY√çL - El≈ëre mozgat√°s</li>
      <li>S / LEFEL√â NY√çL - H√°tra mozgat√°s</li>
      <li>A / BALRA NY√çL - Balra mozgat√°s</li>
      <li>D / JOBBRA NY√çL - Jobbra mozgat√°s</li>
      <li>P - Sz√ºnet</li>
    </ul>
    <p><strong>üìù Fontos:</strong> Most m√°r az aut√≥t mozgathatod el≈ëre √©s h√°tra a p√°ly√°n!</p>
    <p><strong>üí∞ P√©nz:</strong> Kapj 10$-t minden aut√≥ el≈ël sikeresen elhaladva.</p>
    <p><strong>üõí Bolt:</strong> Gy≈±jt√∂tt p√©nzb≈ël v√°s√°rolj fejleszt√©seket a jobb teljes√≠tm√©ny√©rt.</p>
    <p><strong>üö® Neh√©zs√©g:</strong> Min√©l t√∂bb s√°v, ann√°l nehezebb elker√ºlni az aut√≥kat.</p>
  </div>
  <button onclick="closeInstructions()">VISSZA</button>
</div>

<!-- J√ÅT√âK V√âGE -->
<div id="gameOver" class="overlay" style="display:none">
  <h2>üí• J√ÅT√âK V√âGE!</h2>
  <p>√útk√∂zt√©l egy m√°sik aut√≥val.</p>
  <div class="stats">
    <div class="stat">
      <h3>üèÅ T√°vols√°g</h3>
      <p id="finalDistance">0 m</p>
    </div>
    <div class="stat">
      <h3>üí∞ Megszerzett p√©nz</h3>
      <p id="finalMoney">0</p>
    </div>
    <div class="stat">
      <h3>üèÜ Rekord</h3>
      <p id="finalRecord">0 m</p>
    </div>
  </div>
  <button onclick="restartGame()">√öJ J√ÅT√âK</button>
  <button onclick="goToMenu()">F≈êMEN√ú</button>
</div>

<!-- POWERUP INDICATOR -->
<div id="powerupIndicator" class="powerup-indicator" style="display:none">
  <div id="powerupText"></div>
  <div id="powerupTimer"></div>
</div>

<script>
// =========== KONSTANSSOK √âS V√ÅLTOZ√ìK ===========
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

// K√©perny≈ë m√©retez√©s
function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

// Billenty≈±zet
const keys = {};
window.addEventListener("keydown", e => {
  const key = e.key.toLowerCase();
  keys[key] = true;
  
  // P - sz√ºnet
  if (key === 'p') {
    togglePause();
  }
});

window.addEventListener("keyup", e => {
  keys[e.key.toLowerCase()] = false;
});

// J√°t√©k √°llapot
let gameRunning = false;
let gamePaused = false;
let gameOver = false;

// P√©nz √©s pontsz√°m
let money = 0;
let score = 0;
let distance = 0;
let level = 1;
let record = parseInt(localStorage.getItem("record")) || 0;
let maxMoney = parseInt(localStorage.getItem("maxMoney")) || 0;

// J√°t√©kos
const player = {
  x: 0,
  y: 0,
  width: 44,
  height: 76,
  speed: 0,
  maxSpeed: 6,
  acceleration: 0.25,
  handling: 5,
  color: "#ff0000",
  health: 1,
  maxHealth: 1,
  nitro: false,
  nitroTime: 0,
  shield: false,
  shieldTime: 0,
  invincible: false,
  invincibleTime: 0
};

// Ellens√©gek
let enemies = [];
let enemySpawnTimer = 0;
let enemySpeed = 3;
let spawnRate = 90;

// √öt
let lanes = 4;
let laneWidth = 0;
let roadWidth = 0;
let roadX = 0;
let roadY = 0;
let roadHeight = 0;
let difficulty = "normal";

// Power-upok
let powerups = [];
let powerupSpawnTimer = 0;

// H√°tt√©r
let backgroundOffset = 0;
let timeOfDay = 0; // 0-1: nappal, 1-2: √©jszaka

// =========== INICIALIZ√ÅL√ÅS ===========
function init() {
  // Bet√∂ltj√ºk a rekordokat
  record = parseInt(localStorage.getItem("record")) || 0;
  maxMoney = parseInt(localStorage.getItem("maxMoney")) || 0;
  
  // Friss√≠tj√ºk a men√ºt
  document.getElementById("menuRecord").textContent = record + " m";
  document.getElementById("menuMoney").textContent = maxMoney + " $";
  document.getElementById("recordTxt").textContent = record;
  
  // J√°t√©k kezd√©s el≈ëtti √°llapot
  gameRunning = false;
  gamePaused = false;
  gameOver = false;
}

// =========== J√ÅT√âK IND√çT√ÅSA ===========
function startGame() {
  // Be√°ll√≠t√°sok bet√∂lt√©se
  lanes = parseInt(document.getElementById("laneSel").value);
  player.color = document.getElementById("carColor").value;
  difficulty = document.getElementById("difficulty").value;
  
  // Neh√©zs√©g be√°ll√≠t√°sa
  switch(difficulty) {
    case "easy":
      enemySpeed = 2.5;
      spawnRate = 110;
      break;
    case "normal":
      enemySpeed = 3;
      spawnRate = 90;
      break;
    case "hard":
      enemySpeed = 3.5;
      spawnRate = 70;
      break;
  }
  
  // √öt m√©retei
  roadWidth = Math.min(600, lanes * 100);
  laneWidth = roadWidth / lanes;
  roadX = canvas.width / 2 - roadWidth / 2;
  roadHeight = canvas.height * 1.5; // Hosszabb √∫tp√°lya
  roadY = -canvas.height * 0.5; // A p√°lya k√∂zep√©n kezd√ºnk
  
  // J√°t√©kos poz√≠ci√≥ja - a p√°lya k√∂zep√©n
  player.x = canvas.width / 2;
  player.y = canvas.height / 2; // K√∂z√©pen kezd
  player.speed = 0;
  player.health = player.maxHealth;
  
  // Resetelj√ºk a v√°ltoz√≥kat
  money = 0;
  score = 0;
  distance = 0;
  level = 1;
  enemies = [];
  powerups = [];
  backgroundOffset = 0;
  timeOfDay = 0;
  
  // Elrejtj√ºk a men√ºt
  document.getElementById("menu").style.display = "none";
  document.getElementById("shopBtn").style.display = "block";
  document.getElementById("pauseBtn").style.display = "block";
  
  // Friss√≠tj√ºk a HUD-ot
  updateHUD();
  
  // Elind√≠tjuk a j√°t√©kot
  gameRunning = true;
  gamePaused = false;
  gameOver = false;
  
  // J√°t√©k ciklus
  requestAnimationFrame(gameLoop);
}

// =========== J√ÅT√âK CIKLUS ===========
function gameLoop() {
  if (!gameRunning) return;
  
  if (gamePaused || gameOver) {
    requestAnimationFrame(gameLoop);
    return;
  }
  
  // K√©perny≈ë t√∂rl√©se
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  
  // H√°tt√©r rajzol√°sa
  drawBackground();
  
  // √öt rajzol√°sa
  drawRoad();
  
  // J√°t√©kos friss√≠t√©se
  updatePlayer();
  
  // Ellens√©gek friss√≠t√©se
  updateEnemies();
  
  // Power-upok friss√≠t√©se
  updatePowerups();
  
  // √útk√∂z√©s ellen≈ërz√©s
  checkCollisions();
  
  // J√°t√©k√°llapot friss√≠t√©se
  updateGameState();
  
  // HUD friss√≠t√©se
  updateHUD();
  
  // Power-up indik√°tor friss√≠t√©se
  updatePowerupIndicator();
  
  // K√∂vetkez≈ë k√©pkocka
  requestAnimationFrame(gameLoop);
}

// =========== RAJZOL√ÅS ===========
function drawBackground() {
  // √âjszakai/nappali ciklus
  timeOfDay += 0.0001;
  if (timeOfDay > 2) timeOfDay = 0;
  
  const isNight = timeOfDay > 1;
  const brightness = isNight ? 0.3 : 1;
  const skyColor = isNight ? '#0a0a2a' : '#87CEEB';
  
  // √âg
  ctx.fillStyle = skyColor;
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  
  // Felh≈ëk (h√°tt√©rben)
  if (!isNight) {
    drawClouds(backgroundOffset * 0.5);
  }
  
  // Csillagok (√©jszaka)
  if (isNight) {
    drawStars(backgroundOffset * 0.3);
  }
  
  // Hegyek
  drawMountains(backgroundOffset * 0.8);
  
  // F√°k
  drawTrees(backgroundOffset);
  
  // √öt sz√©l√©n h√°zak
  drawHouses(backgroundOffset);
}

function drawRoad() {
  // √öt
  ctx.fillStyle = '#333';
  ctx.fillRect(roadX, roadY, roadWidth, roadHeight);
  
  // K√∂z√©ps≈ë vonal
  ctx.setLineDash([30, 20]);
  ctx.strokeStyle = '#fff';
  ctx.lineWidth = 4;
  ctx.beginPath();
  ctx.moveTo(canvas.width / 2, roadY);
  ctx.lineTo(canvas.width / 2, roadY + roadHeight);
  ctx.stroke();
  
  // S√°vvonalak
  ctx.strokeStyle = '#fff';
  ctx.lineWidth = 2;
  for (let i = 1; i < lanes; i++) {
    const x = roadX + i * laneWidth;
    ctx.beginPath();
    ctx.moveTo(x, roadY);
    ctx.lineTo(x, roadY + roadHeight);
    ctx.stroke();
  }
  
  // √öt sz√©le
  ctx.setLineDash([]);
  ctx.strokeStyle = '#fff';
  ctx.lineWidth = 6;
  ctx.strokeRect(roadX, roadY, roadWidth, roadHeight);
  
  // P√°lya anim√°ci√≥ (vonalak)
  drawRoadLines();
}

function drawRoadLines() {
  // √ötvonal anim√°ci√≥
  backgroundOffset += 2;
  
  ctx.strokeStyle = '#fff';
  ctx.lineWidth = 4;
  ctx.setLineDash([20, 30]);
  
  for (let i = 0; i < lanes; i++) {
    const x = roadX + i * laneWidth + laneWidth / 2;
    for (let y = roadY - 50; y < roadY + roadHeight + 50; y += 100) {
      const lineY = (y + backgroundOffset) % 100 + roadY;
      ctx.beginPath();
      ctx.moveTo(x, lineY);
      ctx.lineTo(x, lineY + 50);
      ctx.stroke();
    }
  }
  
  ctx.setLineDash([]);
}

function drawCar(x, y, width, height, color, isPlayer = false) {
  ctx.save();
  ctx.translate(x, y);
  
  // Aut√≥ karossz√©ria
  ctx.fillStyle = color;
  ctx.beginPath();
  ctx.roundRect(-width / 2, -height / 2, width, height, 10);
  ctx.fill();
  
  // √úveg
  ctx.fillStyle = 'rgba(100, 150, 255, 0.6)';
  ctx.fillRect(-width / 3, -height / 2 + 8, width * 0.66, 14);
  
  // F√©nyek
  const lightColor = isPlayer && player.nitro ? '#ff9900' : '#ffff00';
  ctx.fillStyle = lightColor;
  ctx.fillRect(-width / 2 - 5, -height / 4, 5, 8);
  ctx.fillRect(width / 2, -height / 4, 5, 8);
  
  // Stoppf√©ny
  ctx.fillStyle = '#ff0000';
  ctx.fillRect(-width / 2 - 5, height / 4, 5, 8);
  ctx.fillRect(width / 2, height / 4, 5, 8);
  
  // Pajzs (ha van)
  if (isPlayer && player.shield) {
    ctx.strokeStyle = '#00ffff';
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.arc(0, 0, width / 2 + 10, 0, Math.PI * 2);
    ctx.stroke();
  }
  
  // Sebess√©g effekt
  if (isPlayer && player.nitro) {
    ctx.fillStyle = '#ff9900';
    ctx.beginPath();
    ctx.moveTo(-width / 4, height / 2);
    ctx.lineTo(width / 4, height / 2);
    ctx.lineTo(0, height / 2 + 20);
    ctx.closePath();
    ctx.fill();
  }
  
  // S√©rthetetlens√©g effekt (villog√°s)
  if (isPlayer && player.invincible && Math.floor(Date.now() / 100) % 2 === 0) {
    ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.arc(0, 0, width / 2 + 5, 0, Math.PI * 2);
    ctx.stroke();
  }
  
  ctx.restore();
}

function drawClouds(offset) {
  ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
  for (let i = 0; i < 5; i++) {
    const x = (i * 300 + offset) % (canvas.width + 300) - 150;
    const y = 50 + Math.sin(i * 0.5 + offset * 0.001) * 20;
    const size = 60 + Math.sin(i + offset * 0.002) * 20;
    
    ctx.beginPath();
    ctx.arc(x, y, size, 0, Math.PI * 2);
    ctx.arc(x + size * 0.7, y - size * 0.2, size * 0.7, 0, Math.PI * 2);
    ctx.arc(x - size * 0.7, y - size * 0.2, size * 0.7, 0, Math.PI * 2);
    ctx.fill();
  }
}

function drawMountains(offset) {
  const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height * 0.5);
  gradient.addColorStop(0, '#2c3e50');
  gradient.addColorStop(1, '#34495e');
  
  ctx.fillStyle = gradient;
  
  for (let i = 0; i < 7; i++) {
    const x = (i * 200 + offset * 0.5) % (canvas.width + 200) - 100;
    const height = 100 + Math.sin(i) * 30;
    
    ctx.beginPath();
    ctx.moveTo(x - 100, canvas.height * 0.5);
    ctx.lineTo(x, canvas.height * 0.5 - height);
    ctx.lineTo(x + 100, canvas.height * 0.5);
    ctx.closePath();
    ctx.fill();
  }
}

function drawTrees(offset) {
  ctx.fillStyle = '#2d5016';
  
  for (let side = -1; side <= 1; side += 2) {
    for (let i = 0; i < 15; i++) {
      const x = (i * 80 + offset) % (canvas.width + 80) - 40;
      const treeX = side === -1 ? x - roadWidth / 2 - 30 : x + roadWidth / 2 + 30;
      
      if (treeX < 0 || treeX > canvas.width) continue;
      
      // Fa t√∂rzs
      ctx.fillStyle = '#8B4513';
      ctx.fillRect(treeX - 5, canvas.height * 0.6, 10, 40);
      
      // Korona
      ctx.fillStyle = '#2d5016';
      ctx.beginPath();
      ctx.arc(treeX, canvas.height * 0.6, 25, 0, Math.PI * 2);
      ctx.fill();
    }
  }
}

function drawHouses(offset) {
  for (let side = -1; side <= 1; side += 2) {
    for (let i = 0; i < 8; i++) {
      const x = (i * 150 + offset * 0.8) % (canvas.width + 150) - 75;
      const houseX = side === -1 ? x - roadWidth / 2 - 80 : x + roadWidth / 2 + 80;
      
      if (houseX < 0 || houseX > canvas.width) continue;
      
      // H√°z
      ctx.fillStyle = '#c19a6b';
      ctx.fillRect(houseX - 25, canvas.height * 0.65, 50, 40);
      
      // Tet≈ë
      ctx.fillStyle = '#8b0000';
      ctx.beginPath();
      ctx.moveTo(houseX - 30, canvas.height * 0.65);
      ctx.lineTo(houseX, canvas.height * 0.6);
      ctx.lineTo(houseX + 30, canvas.height * 0.65);
      ctx.closePath();
      ctx.fill();
      
      // Ablakok
      ctx.fillStyle = '#87CEEB';
      ctx.fillRect(houseX - 15, canvas.height * 0.67, 10, 10);
      ctx.fillRect(houseX + 5, canvas.height * 0.67, 10, 10);
    }
  }
}

function drawStars(offset) {
  ctx.fillStyle = '#ffffff';
  
  for (let i = 0; i < 50; i++) {
    const x = (i * 37 + offset) % canvas.width;
    const y = (i * 23) % (canvas.height * 0.5);
    const size = 1 + Math.sin(i + offset * 0.01) * 0.5;
    
    ctx.beginPath();
    ctx.arc(x, y, size, 0, Math.PI * 2);
    ctx.fill();
  }
}

function drawPowerup(x, y, type) {
  ctx.save();
  ctx.translate(x, y);
  
  let color, symbol;
  
  switch(type) {
    case 'nitro':
      color = '#ff9900';
      symbol = 'üöÄ';
      break;
    case 'shield':
      color = '#00ffff';
      symbol = 'üõ°Ô∏è';
      break;
    case 'coin':
      color = '#ffd700';
      symbol = 'üí∞';
      break;
    case 'health':
      color = '#ff0000';
      symbol = '‚ù§Ô∏è';
      break;
  }
  
  // K√∂r alap
  ctx.fillStyle = color;
  ctx.beginPath();
  ctx.arc(0, 0, 20, 0, Math.PI * 2);
  ctx.fill();
  
  // Szimb√≥lum
  ctx.font = '20px Arial';
  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';
  ctx.fillStyle = '#000';
  ctx.fillText(symbol, 0, 2);
  
  // Anim√°ci√≥ (pulz√°l√°s)
  const pulse = Math.sin(Date.now() * 0.01) * 3;
  ctx.strokeStyle = '#fff';
  ctx.lineWidth = 2;
  ctx.beginPath();
  ctx.arc(0, 0, 20 + pulse, 0, Math.PI * 2);
  ctx.stroke();
  
  ctx.restore();
}

// =========== J√ÅT√âKOS KEZEL√âS ===========
function updatePlayer() {
  // El≈ëre-h√°tra mozg√°s
  if (keys.w || keys.arrowup) {
    player.y -= player.handling * 1.5;
  }
  if (keys.s || keys.arrowdown) {
    player.y += player.handling * 1.5;
  }
  
  // Oldalir√°ny√∫ mozg√°s
  if (keys.a || keys.arrowleft) {
    player.x -= player.handling;
  }
  if (keys.d || keys.arrowright) {
    player.x += player.handling;
  }
  
  // P√°ly√°n bel√ºl tart√°s (X tengely)
  const minX = roadX + laneWidth / 2;
  const maxX = roadX + roadWidth - laneWidth / 2;
  player.x = Math.max(minX, Math.min(maxX, player.x));
  
  // P√°ly√°n bel√ºl tart√°s (Y tengely)
  const minY = roadY + player.height / 2;
  const maxY = roadY + roadHeight - player.height / 2;
  player.y = Math.max(minY, Math.min(maxY, player.y));
  
  // Nitro kezel√©se
  if (player.nitro) {
    player.nitroTime--;
    if (player.nitroTime <= 0) {
      player.nitro = false;
    }
  }
  
  // Pajzs kezel√©se
  if (player.shield) {
    player.shieldTime--;
    if (player.shieldTime <= 0) {
      player.shield = false;
    }
  }
  
  // S√©rthetetlens√©g kezel√©se
  if (player.invincible) {
    player.invincibleTime--;
    if (player.invincibleTime <= 0) {
      player.invincible = false;
    }
  }
  
  // Aut√≥ rajzol√°sa
  drawCar(player.x, player.y, player.width, player.height, player.color, true);
  
  // Sebess√©g sz√°m√≠t√°sa (mozg√°s alapj√°n)
  player.speed = Math.sqrt(
    Math.pow(player.x - (player.prevX || player.x), 2) + 
    Math.pow(player.y - (player.prevY || player.y), 2)
  ) * 2;
  
  // El≈ëz≈ë poz√≠ci√≥ ment√©se
  player.prevX = player.x;
  player.prevY = player.y;
}

// =========== ELLENS√âGEK KEZEL√âSE ===========
function updateEnemies() {
  // √öj ellens√©gek spawn-ol√°sa
  enemySpawnTimer++;
  if (enemySpawnTimer > spawnRate) {
    spawnEnemy();
    enemySpawnTimer = 0;
    
    // Neh√©zs√©gi sk√°l√°z√°s
    if (distance % 1000 === 0 && spawnRate > 40) {
      spawnRate -= 5;
      enemySpeed += 0.1;
    }
  }
  
  // Ellens√©gek friss√≠t√©se
  for (let i = enemies.length - 1; i >= 0; i--) {
    const enemy = enemies[i];
    
    // Rajzol√°s
    drawCar(enemy.x, enemy.y, enemy.width, enemy.height, enemy.color);
    
    // P√©nz gy≈±jt√©se (ha elhaladunk mellett√ºk)
    if (!enemy.passed) {
      // Ellen≈ërizz√ºk, hogy az ellenf√©l aut√≥ a k√©perny≈ën bel√ºl van-e
      const enemyOnScreen = enemy.y >= roadY && enemy.y <= roadY + canvas.height;
      const playerOnScreen = player.y >= roadY && player.y <= roadY + canvas.height;
      
      if (enemyOnScreen && playerOnScreen) {
        // Ha a j√°t√©kos aut√≥ja m√∂g√∂tt van az ellenf√©l (a k√©perny≈ën bel√ºl)
        if (enemy.y > player.y + player.height) {
          enemy.passed = true;
          money += 10;
          addScore(10);
          
          // P√©nz effekt
          createFloatingText(enemy.x, enemy.y, "+10$", "#ffd700");
        }
      }
    }
    
    // Ellens√©g mozgat√°sa a p√°ly√°val egy√ºtt
    enemy.y += 2; // Alap mozg√°s
    
    // Oldalir√°ny√∫ mozg√°s (kanyar)
    if (enemy.swerve) {
      enemy.x += enemy.swerveSpeed;
      if (enemy.x < roadX + laneWidth / 2 || enemy.x > roadX + roadWidth - laneWidth / 2) {
        enemy.swerveSpeed *= -1;
      }
    }
    
    // T√∂rl√©s ha elhagyta a p√°ly√°t
    if (enemy.y > roadY + roadHeight + 100) {
      enemies.splice(i, 1);
    }
  }
}

function spawnEnemy() {
  const lane = Math.floor(Math.random() * lanes);
  const x = roadX + lane * laneWidth + laneWidth / 2;
  const y = roadY - 100 - Math.random() * 100; // P√°lya tetej√©n spawn
  
  // V√©letlenszer≈± aut√≥ sz√≠nek
  const colors = ['#3498db', '#2ecc71', '#e74c3c', '#f39c12', '#9b59b6', '#1abc9c'];
  const color = colors[Math.floor(Math.random() * colors.length)];
  
  const enemy = {
    x,
    y,
    width: 44,
    height: 76,
    color,
    passed: false,
    swerve: Math.random() > 0.7, // 30% es√©ly a kanyar√°sra
    swerveSpeed: (Math.random() - 0.5) * 2
  };
  
  enemies.push(enemy);
}

// =========== POWER-UPOK ===========
function updatePowerups() {
  // √öj power-up spawn
  powerupSpawnTimer++;
  if (powerupSpawnTimer > 300 && Math.random() < 0.01) {
    spawnPowerup();
    powerupSpawnTimer = 0;
  }
  
  // Power-upok friss√≠t√©se
  for (let i = powerups.length - 1; i >= 0; i--) {
    const powerup = powerups[i];
    
    // Rajzol√°s
    drawPowerup(powerup.x, powerup.y, powerup.type);
    
    // √útk√∂z√©s ellen≈ërz√©s
    const dx = player.x - powerup.x;
    const dy = player.y - powerup.y;
    const distance = Math.sqrt(dx * dx + dy * dy);
    
    if (distance < 30) {
      collectPowerup(powerup);
      powerups.splice(i, 1);
    }
    
    // Power-up mozgat√°sa a p√°ly√°val egy√ºtt
    powerup.y += 2;
    
    // T√∂rl√©s ha elhagyta a p√°ly√°t
    if (powerup.y > roadY + roadHeight + 50) {
      powerups.splice(i, 1);
    }
  }
}

function spawnPowerup() {
  const lane = Math.floor(Math.random() * lanes);
  const x = roadX + lane * laneWidth + laneWidth / 2;
  const y = roadY - 50;
  
  const types = ['nitro', 'shield', 'coin', 'health'];
  const weights = [0.3, 0.3, 0.3, 0.1]; // Eg√©szs√©g ritk√°bb
  let rand = Math.random();
  let typeIndex = 0;
  
  for (let i = 0; i < weights.length; i++) {
    rand -= weights[i];
    if (rand <= 0) {
      typeIndex = i;
      break;
    }
  }
  
  const powerup = {
    x,
    y,
    type: types[typeIndex]
  };
  
  powerups.push(powerup);
}

function collectPowerup(powerup) {
  switch(powerup.type) {
    case 'nitro':
      player.nitro = true;
      player.nitroTime = 300; // 5 m√°sodperc
      createFloatingText(player.x, player.y, "NITRO!", "#ff9900");
      break;
      
    case 'shield':
      player.shield = true;
      player.shieldTime = 450; // 7.5 m√°sodperc
      createFloatingText(player.x, player.y, "PAJZS!", "#00ffff");
      break;
      
    case 'coin':
      const coinAmount = 50 + Math.floor(Math.random() * 50);
      money += coinAmount;
      addScore(coinAmount);
      createFloatingText(player.x, player.y, `+${coinAmount}$`, "#ffd700");
      break;
      
    case 'health':
      if (player.health < player.maxHealth) {
        player.health++;
        createFloatingText(player.x, player.y, "+1 √âLET", "#ff0000");
      } else {
        money += 30; // Ha teljes az √©let, kap p√©nzt helyette
        createFloatingText(player.x, player.y, "+30$", "#ffd700");
      }
      break;
  }
}

// =========== √úTK√ñZ√âSEK ===========
function checkCollisions() {
  if (player.invincible) return;
  
  for (const enemy of enemies) {
    const dx = player.x - enemy.x;
    const dy = player.y - enemy.y;
    const distance = Math.sqrt(dx * dx + dy * dy);
    const collisionDistance = (player.width + enemy.width) / 2 * 0.7;
    
    if (distance < collisionDistance) {
      // Pajzs v√©d
      if (player.shield) {
        player.shield = false;
        player.shieldTime = 0;
        player.invincible = true;
        player.invincibleTime = 60; // 1 m√°sodperc s√©rthetetlens√©g
        
        // Effekt
        createExplosion(enemy.x, enemy.y);
        enemies.splice(enemies.indexOf(enemy), 1);
        createFloatingText(player.x, player.y, "PAJZS T√ñRVE", "#00ffff");
        return;
      }
      
      // √âlet cs√∂kken√©s
      player.health--;
      player.invincible = true;
      player.invincibleTime = 120; // 2 m√°sodperc s√©rthetetlens√©g
      
      // Effekt
      createExplosion(player.x, player.y);
      
      if (player.health <= 0) {
        endGame();
      } else {
        createFloatingText(player.x, player.y, `-1 √âLET (${player.health} maradt)`, "#ff0000");
        document.getElementById("healthTxt").textContent = `${player.health}/${player.maxHealth}`;
      }
      
      break;
    }
  }
}

// =========== J√ÅT√âK√ÅLLAPOT ===========
function updateGameState() {
  // T√°vols√°g sz√°mol√°sa (az aut√≥ mozg√°sa alapj√°n)
  distance += Math.abs(player.speed) * 0.05;
  
  // Szint emel√©s
  const newLevel = Math.floor(distance / 1000) + 1;
  if (newLevel > level) {
    level = newLevel;
    createFloatingText(canvas.width / 2, canvas.height / 2, `SZINT ${level}!`, "#2ecc71");
    
    // Szintl√©p√©s b√≥nusz
    money += level * 20;
    addScore(level * 50);
  }
  
  // Rekord friss√≠t√©se
  if (distance > record) {
    record = distance;
    localStorage.setItem("record", Math.floor(record));
  }
  
  // Max p√©nz friss√≠t√©se
  if (money > maxMoney) {
    maxMoney = money;
    localStorage.setItem("maxMoney", maxMoney);
  }
}

// =========== EFFEKTEK ===========
function createFloatingText(x, y, text, color) {
  // Egyszer≈± lebeg≈ë sz√∂veg
  ctx.save();
  ctx.font = 'bold 20px Arial';
  ctx.fillStyle = color;
  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';
  ctx.fillText(text, x, y);
  ctx.restore();
}

function createExplosion(x, y) {
  // Egyszer≈± robban√°s effekt
  for (let i = 0; i < 8; i++) {
    const angle = Math.random() * Math.PI * 2;
    const speed = 1 + Math.random() * 2;
    const size = 3 + Math.random() * 7;
    
    ctx.save();
    ctx.translate(x, y);
    
    ctx.fillStyle = `rgba(255, ${100 + Math.random() * 155}, 0, 0.8)`;
    ctx.beginPath();
    ctx.arc(
      Math.cos(angle) * speed * 5,
      Math.sin(angle) * speed * 5,
      size,
      0,
      Math.PI * 2
    );
    ctx.fill();
    
    ctx.restore();
  }
}

// =========== BOLT ===========
function openShop() {
  gamePaused = true;
  document.getElementById("shop").style.display = "flex";
  updateShop();
}

function closeShop() {
  gamePaused = false;
  document.getElementById("shop").style.display = "none";
}

function updateShop() {
  document.getElementById("shopMoney").textContent = money;
  
  // Sebess√©g
  const speedPercent = (player.maxSpeed - 6) / 9 * 100;
  document.getElementById("speedBar").style.width = speedPercent + "%";
  document.getElementById("currentSpeed").textContent = player.maxSpeed;
  document.getElementById("speedBtn").disabled = player.maxSpeed >= 15 || money < 50;
  document.getElementById("speedBtn").textContent = 
    player.maxSpeed >= 15 ? "MAX SZINT" : `+1 Sebess√©g - 50$`;
  
  // Gyorsul√°s
  const accelPercent = (player.acceleration - 0.25) / 0.25 * 100;
  document.getElementById("accelBar").style.width = accelPercent + "%";
  document.getElementById("currentAccel").textContent = player.acceleration.toFixed(2);
  document.getElementById("accelBtn").disabled = player.acceleration >= 0.5 || money < 40;
  document.getElementById("accelBtn").textContent = 
    player.acceleration >= 0.5 ? "MAX SZINT" : `+0.05 Gyorsul√°s - 40$`;
  
  // Ir√°ny√≠t√°s
  const handlingPercent = (player.handling - 5) / 10 * 100;
  document.getElementById("handlingBar").style.width = handlingPercent + "%";
  document.getElementById("currentHandling").textContent = player.handling;
  document.getElementById("handlingBtn").disabled = player.handling >= 15 || money < 30;
  document.getElementById("handlingBtn").textContent = 
    player.handling >= 15 ? "MAX SZINT" : `+1 Ir√°ny√≠t√°s - 30$`;
  
  // √âlet
  const healthPercent = (player.maxHealth - 1) / 4 * 100;
  document.getElementById("healthBar").style.width = healthPercent + "%";
  document.getElementById("currentHealth").textContent = player.maxHealth;
  document.getElementById("healthBtn").disabled = player.maxHealth >= 5 || money < 80;
  document.getElementById("healthBtn").textContent = 
    player.maxHealth >= 5 ? "MAX SZINT" : `+1 √âlet - 80$`;
}

function buyUpgrade(type) {
  switch(type) {
    case 'speed':
      if (money >= 50 && player.maxSpeed < 15) {
        money -= 50;
        player.maxSpeed++;
      }
      break;
    case 'accel':
      if (money >= 40 && player.acceleration < 0.5) {
        money -= 40;
        player.acceleration += 0.05;
      }
      break;
    case 'handling':
      if (money >= 30 && player.handling < 15) {
        money -= 30;
        player.handling++;
      }
      break;
    case 'health':
      if (money >= 80 && player.maxHealth < 5) {
        money -= 80;
        player.maxHealth++;
        player.health = player.maxHealth; // Teljes √©leter≈ë
        document.getElementById("healthTxt").textContent = `${player.health}/${player.maxHealth}`;
      }
      break;
  }
  
  updateShop();
  updateHUD();
}

// =========== HUD ===========
function updateHUD() {
  document.getElementById("moneyTxt").textContent = money;
  document.getElementById("speedTxt").textContent = player.speed.toFixed(1);
  document.getElementById("recordTxt").textContent = Math.floor(record);
  document.getElementById("levelTxt").textContent = level;
  document.getElementById("distanceTxt").textContent = Math.floor(distance);
  document.getElementById("speedValue").textContent = Math.abs(Math.floor(player.speed * 10));
  document.getElementById("healthTxt").textContent = `${player.health}/${player.maxHealth}`;
}

function updatePowerupIndicator() {
  const indicator = document.getElementById("powerupIndicator");
  const text = document.getElementById("powerupText");
  const timer = document.getElementById("powerupTimer");
  
  if (player.nitro || player.shield) {
    indicator.style.display = "block";
    
    if (player.nitro) {
      text.textContent = "üöÄ NITRO";
      timer.textContent = `‚è±Ô∏è ${Math.ceil(player.nitroTime / 60)}s`;
      indicator.style.borderLeftColor = "#ff9900";
    } else if (player.shield) {
      text.textContent = "üõ°Ô∏è PAJZS";
      timer.textContent = `‚è±Ô∏è ${Math.ceil(player.shieldTime / 60)}s`;
      indicator.style.borderLeftColor = "#00ffff";
    }
  } else {
    indicator.style.display = "none";
  }
}

// =========== J√ÅT√âK V√âGE ===========
function endGame() {
  gameOver = true;
  gameRunning = false;
  
  // J√°t√©k v√©ge k√©perny≈ë
  document.getElementById("finalDistance").textContent = Math.floor(distance) + " m";
  document.getElementById("finalMoney").textContent = money + " $";
  document.getElementById("finalRecord").textContent = Math.floor(record) + " m";
  document.getElementById("gameOver").style.display = "flex";
  
  // Bolt gomb elrejt√©se
  document.getElementById("shopBtn").style.display = "none";
  document.getElementById("pauseBtn").style.display = "none";
}

function restartGame() {
  document.getElementById("gameOver").style.display = "none";
  startGame();
}

function goToMenu() {
  document.getElementById("gameOver").style.display = "none";
  document.getElementById("menu").style.display = "flex";
}

// =========== SZ√úNET ===========
function togglePause() {
  if (!gameRunning || gameOver) return;
  
  gamePaused = !gamePaused;
  document.getElementById("pauseBtn").textContent = gamePaused ? "‚ñ∂Ô∏è" : "‚è∏Ô∏è";
}

// =========== PONT SZ√ÅM√çT√ÅS ===========
function addScore(amount) {
  score += amount;
}

// =========== √öTMUTAT√ì ===========
function showInstructions() {
  document.getElementById("menu").style.display = "none";
  document.getElementById("instructions").style.display = "flex";
}

function closeInstructions() {
  document.getElementById("instructions").style.display = "none";
  document.getElementById("menu").style.display = "flex";
}

// =========== IND√çT√ÅS ===========
window.addEventListener("load", init);

// Bolt gomb esem√©nykezel≈ë
document.getElementById("shopBtn").addEventListener("click", openShop);
document.getElementById("pauseBtn").addEventListener("click", togglePause);
</script>
</body>
</html>